# Common Configuration (shared across all boards)


# Secure Boot V2 (ESP32-C3 uses ECDSA - auto-selected when RSA is disabled)
# CONFIG_SECURE_BOOT_SIGNING_KEY="secure_boot/ecdsa_signing_key.pem"
# CONFIG_SECURE_BOOT_BUILD_SIGNED_BINARIES=y
# CONFIG_SECURE_BOOT_V2_ENABLED=y
# CONFIG_SECURE_BOOT=y

# Flash Encryption
# CONFIG_SECURE_FLASH_ENC_ENABLED=n

# Secure/Insecure Download Mode
CONFIG_SECURE_INSECURE_ALLOW_DL_MODE=y
CONFIG_SECURE_ROM_DL_MODE_ENABLED=y

# WiFi
CONFIG_ESP32_WIFI_ENABLED=y
CONFIG_ESP32_WIFI_STATIC_RX_BUFFER_NUM=10
CONFIG_ESP32_WIFI_DYNAMIC_RX_BUFFER_NUM=32

# mDNS
CONFIG_MDNS_MAX_SERVICES=10
CONFIG_MDNS_TASK_PRIORITY=1
CONFIG_MDNS_TASK_STACK_SIZE=4096
CONFIG_MDNS_TASK_AFFINITY_CPU0=y
CONFIG_MDNS_SERVICE_ADD_TIMEOUT_MS=2000

# LittleFS
CONFIG_LITTLEFS_MAX_PARTITIONS=3
CONFIG_LITTLEFS_OBJ_NAME_LEN=64
CONFIG_LITTLEFS_PAGE_SIZE=256
CONFIG_LITTLEFS_USE_MTIME=y

# Camera (esp32-camera component)
# Needed when building with esp32-camera; harmless otherwise.
CONFIG_SCCB_CLK_FREQ=100000

# WebSocket
CONFIG_HTTPD_WS_SUPPORT=y

# -----------------------------------------------------------------------------
# System event task (ESP-IDF)
# -----------------------------------------------------------------------------
#
# ESP-IDF runs the "sys_evt" task for system/event loop callbacks (WiFi/BT/etc).
# The default stack is too small for this project on ESP32-WROOM-32 class boards
# and results in a reboot loop:
#   "***ERROR*** A stack overflow in task sys_evt has been detected."
#
# Keep this reasonably sized; 4096 has been sufficient in practice.
CONFIG_ESP_SYSTEM_EVENT_TASK_STACK_SIZE=4096
# Back-compat name seen in some configs/IDF versions.
CONFIG_SYSTEM_EVENT_TASK_STACK_SIZE=4096
CONFIG_ESP_MAIN_TASK_STACK_SIZE=4096

# -----------------------------------------------------------------------------
# Flash size (ESP-IDF / esptoolpy)
# -----------------------------------------------------------------------------
# CONFIG_ESPTOOLPY_FLASHSIZE_2MB is not set
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHSIZE="4MB"

# Logging
# Changed from DEBUG to INFO to reduce binary size
# CONFIG_BOOTLOADER_LOG_LEVEL_DEBUG=y

# Optimization
# CONFIG_COMPILER_OPTIMIZATION_DEFAULT=y
CONFIG_COMPILER_OPTIMIZATION_SIZE=y
CONFIG_BOOTLOADER_COMPILER_OPTIMIZATION_SIZE=y


#
# Select 4MB flash size (avoids "Expected 4MB, found 2MB!" warning at build).
# CONFIG_ESPTOOLPY_FLASHSIZE_2MB is not set
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHSIZE="4MB"

# ESP32-C3 Specific Configuration

# Explicitly disable RSA (ESP32-C3 only supports ECDSA for secure boot)
# CONFIG_SECURE_BOOT_V2_RSA_ENABLED is not set
# CONFIG_SECURE_SIGNED_APPS_RSA_SCHEME is not set

# Flash Configuration
CONFIG_ESPTOOLPY_FLASHMODE_DIO=y
CONFIG_ESPTOOLPY_FLASHFREQ_80M=y
CONFIG_ESPTOOLPY_FLASHSIZE_4MB=y
CONFIG_ESPTOOLPY_FLASHSIZE="4MB"

# Partition Table
CONFIG_PARTITION_TABLE_CUSTOM=y
CONFIG_PARTITION_TABLE_OFFSET=0x8000
CONFIG_PARTITION_TABLE_CUSTOM_FILENAME="partitions/espwifi_4MB.csv"

# CPU Configuration
CONFIG_ESP32_DEFAULT_CPU_FREQ_160=y
CONFIG_ESP32_REV_MIN_3=y
# CONFIG_FREERTOS_UNICORE=y

# Performance Optimizations
CONFIG_COMPILER_OPTIMIZATION_PERF=y
CONFIG_BOOTLOADER_COMPILER_OPTIMIZATION_PERF=y
# CONFIG_FREERTOS_HZ=1000
# CONFIG_ESP_WIFI_EXTRA_IRAM_OPT=y


# Bluetooth (Classic / Bluedroid - A2DP Source)
# ==========================================================
CONFIG_BT_ENABLED=y
CONFIG_BT_BLUEDROID_ENABLED=y
# CONFIG_BT_NIMBLE_ENABLED is not set
# CONFIG_BT_CONTROLLER_ONLY is not set
CONFIG_BT_CONTROLLER_ENABLED=y
# CONFIG_BT_CONTROLLER_DISABLED is not set

CONFIG_BT_BTC_TASK_STACK_SIZE=3072
CONFIG_BT_BLUEDROID_PINNED_TO_CORE_0=y
# CONFIG_BT_BLUEDROID_PINNED_TO_CORE_1 is not set
CONFIG_BT_BLUEDROID_PINNED_TO_CORE=0
CONFIG_BT_BTU_TASK_STACK_SIZE=4352
# CONFIG_BT_BLUEDROID_MEM_DEBUG is not set
CONFIG_BT_BLUEDROID_ESP_COEX_VSC=y
CONFIG_BT_CLASSIC_ENABLED=y
CONFIG_BT_ENC_KEY_SIZE_CTRL_VSC=y
# CONFIG_BT_ENC_KEY_SIZE_CTRL_NONE is not set
# CONFIG_BT_CLASSIC_BQB_ENABLED is not set

# A2DP / AVRCP (required for ESP32-A2DP source)
CONFIG_BT_A2DP_ENABLE=y
# CONFIG_BT_A2DP_USE_EXTERNAL_CODEC is not set
CONFIG_BT_AVRCP_ENABLED=y
CONFIG_BT_SMP_ENABLE=y

# Explicitly disable non-audio BT profiles/features (RAM saver)
# Keep: Classic BT + A2DP Source + AVRCP + SMP (pairing)
#
# Note: We intentionally do NOT touch AVRCP cover art here because ESP-IDF 5.5.0
# has an unconditional reference to `rc_cover_art_connected` in `btc_avrc.c`
# which can break builds if cover-art is toggled off.
#
# Classic profiles we don't use
CONFIG_BT_SPP_ENABLED=n
CONFIG_BT_HFP_ENABLE=n
CONFIG_BT_HID_ENABLED=n
CONFIG_BT_PBAC_ENABLED=n
CONFIG_BT_GOEPC_ENABLED=n
#
# BLE + GATT (not used; we run BR/EDR only)
CONFIG_BT_BLE_ENABLED=n
CONFIG_BT_GATTS_ENABLE=n
CONFIG_BT_GATTC_ENABLE=n
CONFIG_BT_BLE_SMP_ENABLE=n
CONFIG_BT_BLE_BLUFI_ENABLE=n


# Controller mode: Classic only (saves RAM/flash)
# CONFIG_BTDM_CTRL_MODE_BLE_ONLY is not set
CONFIG_BTDM_CTRL_MODE_BR_EDR_ONLY=y
# CONFIG_BTDM_CTRL_MODE_BTDM is not set